<section class="container">
  <form [formGroup]="orderForm">
    <div>
      <h3>Ajoutez des produits et générez votre facture!</h3>
      <div>
        <label>Nombre de produits</label>
        <input min="0" type="number" formControlName="numberOfProducts" (change)="onChangeProductsNumber()"
               [ngClass]="{ 'is-invalid': isOrderFormSubmitted && orderForm.controls['numberOfProducts'].errors }"/>
        <div class="error" *ngIf="isOrderFormSubmitted && orderForm.controls['numberOfProducts'].errors">Nombre Produit
          Obligatoire
        </div>
      </div>
      <div *ngFor="let order of orderFormGroups; let i = index">
        <h5 class="card-title">Produit {{i | identity}}</h5>
        <div class="row" [formGroup]="order" *ngIf="order">
          <ng-container formGroupName="product">
            <div class="column">
              <label [for]="'category'+i">Catégorie</label>
              <select [id]="'category'+i" formControlName="category" *ngIf="(categories$ | async) as categories"
                      [ngClass]="{ 'is-invalid': isOrderFormSubmitted && order.get('product.category')?.errors }">
                <option value="">Catégorie du produit</option>
                <option *ngFor="let category of categories" [ngValue]="category">{{category.name}}</option>
              </select>
              <div class="error" *ngIf="isOrderFormSubmitted && order.get('product.category')?.errors">
                <span *ngIf="order.get('product.category')?.errors?.['required']">Catégorie Obligatoire</span>
              </div>
            </div>
            <div class="column">
              <input type="checkbox" [id]="'import'+i" formControlName="isImport">
              <label [id]="'import'+i"> Importé</label>
            </div>
            <div class="column">
              <label [for]="'name'+i">Nom</label>
              <input type="text" [id]="'name'+i" formControlName="name"
                     [ngClass]="{ 'is-invalid': isOrderFormSubmitted && order.get('product.name')?.errors }"/>
              <div class="error" *ngIf="isOrderFormSubmitted && order.get('product.name')?.errors">
                <span
                  *ngIf="order.get('product.name')?.errors?.['required']">Nom Obligatoire</span>
                <span
                  *ngIf="order.get('product.name')?.errors?.['minlength']">Doit avoir au moins 2 caractères</span>
                <span
                  *ngIf="order.get('product.name')?.errors?.['maxlength']">Doit avoir au plus 50 caractères</span>
              </div>
            </div>
            <div class="column">
              <label [for]="'price'+i">Prix</label>
              <input min="0" type="number" [id]="'price'+i" formControlName="price"
                     [ngClass]="{ 'is-invalid': isOrderFormSubmitted && order.get('product.price')?.errors }"/>
              <div class="error" *ngIf="isOrderFormSubmitted && order.get('product.price')?.errors">
                <span
                  *ngIf="order.get('product.price')?.errors?.['required']">Prix Obligatoire</span>
              </div>
            </div>
          </ng-container>
          <div class="column">
            <label [for]="'quantity'+i">Quantité</label>
            <input OnlyNumber min="0" type="number" [id]="'quantity'+i" formControlName="quantity" class="onlyNumber"
                   [ngClass]="{ 'is-invalid': isOrderFormSubmitted && order.get('quantity')?.errors }"/>
            <div class="error" *ngIf="isOrderFormSubmitted && order.get('quantity')?.errors">
              <span
                *ngIf="order.get('quantity')?.errors?.['required']">Quantité Obligatoire</span>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <div>
        <button class="button button-receipt" type="submit" (click)="submitForm(orderForm)">Générer Facture</button>
      </div>
    </div>
  </form>
</section>
